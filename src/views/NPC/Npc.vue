<template>
  <NavBar>
    <template v-slot:header>{{ npc?.name }}</template>
    <template v-slot:body>
      <div v-if="npc != null">
        <div @click="$router.push($route.path)" v-if="$route.query.edit !== undefined && !canWrite(npc.permissionWrite)" class="mt-52 text-center">
          <span class="text-5xl">You are not allowed to be here!</span>
          <button type="button" class="block mx-auto mt-12 items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Go back
          </button>
        </div>
        <div v-else>
          <TextEdit v-if="npc" v-for="desc in npc.description" :editable="$route.query.edit !== undefined && canWrite(npc.permissionWrite)" class="my-5" v-model:value="desc.content" @blur="updateDescription"/>
        </div>
      </div>
    </template>

  </NavBar>
</template>
<script>
import NavBar from "@/components/NavBar";
import TextEdit from "@/components/TextEdit";
import {updateDoc} from "firebase/firestore";
import {canWrite} from "@/plugins/permissions";

export default {
  components: {NavBar, TextEdit},
  computed: {
    npc() {
      return this.$store.state.npcs.find((npc) => npc._id === this.$route.params.id);
    },
  },
  methods: {
    updateDescription() {
      console.log(this.npc.ref(), this.npc.description)
      updateDoc(this.npc.ref(), {
        description: this.npc.description
      }).catch((err) => {
        console.log(err)
      })
    },
    canWrite,
  }
}
</script>
